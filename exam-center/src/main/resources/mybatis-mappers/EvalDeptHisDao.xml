<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cloud.exam.dao.EvalDeptHisDao">

    <!--单位综合能力-->
   <select id="getDeptKpScore" resultType="map" parameterType="map">
        SELECT
        *
        FROM
        exam_eval_dept_his
        WHERE
        1 = 1
        AND department_id = #{deptId}
       <if test="kpIds != null and kpIds.length >0 ">
           AND kp_id in
           <foreach collection="kpIds" index="index" item="kpId" open="(" separator="," close=")" >
               #{kpId}
           </foreach>
       </if>
   </select>

    <!--单位综合能力得分-->
    <select id="getDeptScore" resultType="map" parameterType="map">
        SELECT AVG
        ( eval_score ) as avg
        FROM
        exam_eval_dept_his
        WHERE
        1 = 1
        AND department_id = #{deptId}
    </select>

    <select id="getTopKpName" parameterType="map" resultType="map">
        SELECT
        DISTINCT kp_id,eval_score
        FROM
        exam_eval_dept_his
        WHERE
        1 = 1
        ORDER BY
        eval_score DESC
        LIMIT #{limitNum}
    </select>

    <delete id="delDeptHis" parameterType="map">
        DELETE
        FROM
        exam_eval_dept_his
        WHERE
        1 = 1
        AND kp_id = #{kpId}
        AND department_id =#{deptId}
    </delete>

</mapper>


