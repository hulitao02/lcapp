<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Insert title here</title>
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="../../css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="../../css/dataTables.bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="../../layui/css/layui.css"
    />
  </head>
  <body>
    <div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <header style="height: 100%">
          <div align="left">
            <table style="width: 100%">
              <tr>
                <td>
                  <form class="form-inline" onsubmit="return false">
                    <div class="form-group">
                      服务名称：
                      <input
                        id="name"
                        type="text"
                        class="form-control"
                        placeholder="服务名称"
                      />
                    </div>
                  </form>
                </td>
                <td align="right">
                  <button
                    class="layui-btn layui-btn-sm"
                    onclick="location.href='addIntDirect.html'"
                    permission="back:intdirect:save"
                  >
                    <i class="layui-icon">&#xe608;</i> 添加
                  </button>
                </td>
              </tr>
            </table>
          </div>
        </header>

        <div>
          <div class="widget-body no-padding">
            <table
              id="dt-table"
              class="table table-striped table-bordered table-hover"
              style="width: 100%"
            >
              <thead>
                <tr></tr>
                <tr>
                  <!--<th>id</th>-->
                  <th>名称</th>
                  <th>地址</th>
                  <th>描述</th>
                  <th width="15%">操作</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="../../js/constant.js"></script>
  <script
    type="text/javascript"
    src="../../js/libs/jquery-3.3.1.min.js"
  ></script>
  <script type="text/javascript" src="../../js/jq.js"></script>
  <script
    type="text/javascript"
    src="../../js/plugin/datatables/jquery.dataTables.min.js"
  ></script>
  <script
    type="text/javascript"
    src="../../js/plugin/datatables/dataTables.bootstrap.min.js"
  ></script>
  <script type="text/javascript" src="../../layui/layui.js"></script>
  <script type="text/javascript" src="../../js/my/permission.js"></script>
  <script type="text/javascript">
    domainName = "";
    var pers = checkPermission();
    var example;

    layui.use(["layer", "util"], function () {
      var layer = layui.layer;
      var util = layui.util;

      function init() {
        example = $("#dt-table").DataTable({
          searching: false,
          processing: false,
          serverSide: true,
          ordering: false,
          language: {
            url: "../../js/plugin/datatables/Chinese.lang",
          },
          ajax: {
            url: domainName + "/api-b/intDirect",
            type: "get",
            data: function (d) {
              d.name = $("#name").val();
              d.country = $("#country").val();
              /*d.describe = $('#describe').val();*/
            },
            dataSrc: function (json) {
              json.recordsTotal = 30;
              json.recordsFiltered = 30;
              json.data = [
                {
                  name: "试题管理",
                  address: "/exam/QuestionManage",
                  describe: "支持试题的增、删、改、查、导入、导出。",
                },
                {
                  name: "角色管理",
                  address: "/exam/RoleManage",
                  describe: "支持角色的增、删、改、查",
                },
                {
                  name: "菜单管理",
                  address: "/exam/MenuManage",
                  describe: "支持菜单的增、删、改、查",
                },
                {
                  name: "活动管理",
                  address: "/exam/ActivityManage",
                  describe:
                    "支持活动的增、删、改、查，管理活动小组、参赛人员、活动试卷、管理小组、比赛场地。",
                },
                {
                  name: "试卷管理",
                  address: "/exam/PaperManage",
                  describe: "支持试卷的增、删、改、查。",
                },
                {
                  name: "在线考核",
                  address: "/exam/Assessment",
                  describe: "在线考核功能",
                },
                {
                  name: "阅卷服务",
                  address: "/exam/MarkPapers",
                  describe: "为临时阅卷角色配置的阅卷功能。",
                },
                {
                  name: "监考服务",
                  address: "/exam/Invigilate",
                  describe: "为临时监考角色配置的监考功能。",
                },
                {
                  name: "知识模板管理",
                  address: "/exam/KnowledgeModel",
                  describe: "支持知识模板及分组的增、删、改、查",
                },
                {
                  name: "模板挂接知识点",
                  address: "/exam/ModelKP",
                  describe: "知识模板与知识点的挂接",
                },
              ];
              return json.data;
            },
            error: function (xhr, textStatus, errorThrown) {
              var msg = xhr.responseText;
              console.log(msg);
              if (xhr.status == 400) {
                layer.msg(JSON.parse(msg).message);
              } else if (xhr.status == 401) {
                localStorage.removeItem("token");
                layer.msg(
                  "token过期，请重新登录",
                  { shift: -1, time: 1000 },
                  function () {
                    location.href = loginPage;
                  }
                );
              } else if (xhr.status == 403) {
                layer.msg("未授权");
              } else if (xhr.status == 500) {
                var info = JSON.parse(msg);
                var exception = info.exception;
                var message = info.message;
                layer.msg("系统错误：" + (exception ? exception : message));
              }
            },
          },
          dom:
            "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
          columns: [
            // { "data": "id", "defaultContent": ""},
            { data: "name", defaultContent: "" },
            { data: "address", defaultContent: "" },
            { data: "describe", defaultContent: "" },
            {
              data: "",
              defaultContent: "",
              render: function (data, type, row) {
                var id = row["id"];
                var name = encodeURIComponent(row["name"]);
                var country = encodeURIComponent(row["country"]);
                var describe = encodeURIComponent(row["describe"]);
                var href =
                  "updateIntDirect.html?id=" +
                  id +
                  "&name=" +
                  name +
                  "&country=" +
                  country +
                  "&describe=" +
                  describe;
                var edit = buttonEdit(href, "back:intdirect:update", pers);
                var del = buttonDel(id, "back:intdirect:delete", pers);

                return edit + del;
              },
            },
          ],
        });
      }

      init();
    });

    function del(id) {
      layer.confirm(
        "确定要删除吗？",
        {
          btn: ["确定", "取消"],
        },
        function () {
          $.ajax({
            type: "delete",
            url: domainName + "/api-b/intDirect/" + id,
            success: function (data) {
              example.ajax.reload();
              layer.msg("删除成功");
            },
          });

          layer.close(1);
        }
      );
    }
    function showData(id) {
      layer.open({
        title: "查看",
        type: 1,
        area: ["500px", "400px"],
        maxmin: true,
        shadeClose: true,
        content: $("#" + id).attr("data"),
      });
    }
  </script>
</html>
